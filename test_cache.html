<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test BrazilianStandardAddress Cache History</title>
</head>
<body>
    <h1>Testing BrazilianStandardAddress Cache History Behavior</h1>
    <div id="output"></div>
    <div id="bottom-scroll-textarea" style="height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; background: #f9f9f9;"></div>

    <script src="guia.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function addOutput(message) {
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }

        try {
            addOutput('Testing BrazilianStandardAddress cache history-like behavior...');

            // Test 1: Set small cache size to test LRU eviction
            addOutput('<strong>=== Test 1: LRU eviction behavior ===</strong>');
            AddressDataExtractor.setMaxCacheSize(3);

            const testData = [
                { address: { street: 'First St', house_number: '100', city: 'TestCity' } },
                { address: { street: 'Second St', house_number: '200', city: 'TestCity' } },
                { address: { street: 'Third St', house_number: '300', city: 'TestCity' } },
                { address: { street: 'Fourth St', house_number: '400', city: 'TestCity' } }
            ];

            // Add 3 entries (cache limit)
            addOutput('Adding 3 entries to fill cache...');
            for (let i = 0; i < 3; i++) {
                AddressDataExtractor.getBrazilianStandardAddress(testData[i]);
                addOutput(`Cache size after adding entry ${i + 1}: ${AddressDataExtractor.getCacheSize()}`);
            }

            addOutput('Accessing first entry again (should move it to most recent)...');
            AddressDataExtractor.getBrazilianStandardAddress(testData[0]);

            addOutput('Adding 4th entry (should evict least recently used)...');
            AddressDataExtractor.getBrazilianStandardAddress(testData[3]);
            addOutput(`Cache size after adding 4th entry: ${AddressDataExtractor.getCacheSize()}`);

            // Test 2: Verify history-like access behavior
            addOutput('<strong>=== Test 2: History-like access behavior ===</strong>');
            addOutput('Testing that recently accessed items stay in cache...');

            // Clear cache and start fresh
            AddressDataExtractor.clearCache();
            AddressDataExtractor.setMaxCacheSize(2);

            // Add two entries
            addOutput('Adding two entries...');
            AddressDataExtractor.getBrazilianStandardAddress(testData[0]);
            AddressDataExtractor.getBrazilianStandardAddress(testData[1]);

            // Access first entry to make it most recent
            addOutput('Accessing first entry to make it most recent...');
            AddressDataExtractor.getBrazilianStandardAddress(testData[0]);

            // Add third entry (should evict second entry, not first)
            addOutput('Adding third entry (should evict second entry, not first)...');
            AddressDataExtractor.getBrazilianStandardAddress(testData[2]);

            // Try to access second entry (should create new, not from cache)
            addOutput('Trying to access second entry again (should create new)...');
            AddressDataExtractor.getBrazilianStandardAddress(testData[1]);

            addOutput('<strong>=== Test completed ===</strong>');
            addOutput('Check the console logs to see "Using cached" vs "Creating new" messages.');
            addOutput('If recently accessed items stay cached and old items are evicted, LRU is working!');

        } catch (error) {
            addOutput('<strong>Error:</strong> ' + error.message);
            console.error('Test error:', error);
        }
    </script>
</body>
</html>